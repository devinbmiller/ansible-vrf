vrf definition {{ vrf.name }}
 !
 address-family ipv4
 exit-address-family
!
!
vlan {{ vrf.vlan }}
 name {{ vrf.name }}
vlan {{ vrf_trans1.vlan }}
 name {{ vrf_trans1.name }}
vlan {{ vrf_trans2.vlan }}
 name {{ vrf_trans2.name }}
!
!
{% if inventory_hostname[-1] == "1" %}
spanning-tree vlan {{ vrf.vlan }} priority 24576
!
{% else %}
spanning-tree vlan {{ vrf.vlan }} priority 28672
{% endif -%} 
!
interface {{ L3.trans1.name }}
 switchport trunk allowed vlan add {{ vrf_trans1.vlan }}
!
interface {{ L3.trans2.name }}
 switchport trunk allowed vlan add {{ vrf_trans2.vlan }}
!
interface {{ lag_interface.name }}
 switchport trunk allowed vlan add {{ vrf.vlan }}
!
{% for range in access_downlinks.ranges %}
interface range {{ range }}
 switchport trunk allowed vlan add {{ vrf.vlan }}
{% endfor %}
!
{% for interface in access_downlinks.interfaces %}
interface {{ interface }}
 switchport trunk allowed vlan add {{ vrf.vlan }}
{% endfor %}
!
interface Vlan{{ vrf_trans1.vlan }}
 description {{ vrf_trans1.name }}
 vrf forwarding {{ vrf.name }}
 {% if inventory_hostname[-1] == "1" -%}
 ip address {{ L3.trans1.router1_ip }} {{ L3.trans_mask }}
 {% else -%}
 ip address {{ L3.trans1.router2_ip }} {{ L3.trans_mask }}
 {% endif -%}
 no ip redirects
 ip pim sparse-mode
 ip ospf {{ vrf.vlan }} area 0
 no shutdown
!
{#
interface Vlan{{ vrf.routers.trans_2.vlan }}
 description {{ vrf.name }} {{ vrf.routers.trans_2.description }}
 vrf forwarding {{ vrf.name }}
 {% if inventory_hostname[-1] == "1" -%}
 ip address {{ vrf.routers.trans_2.r1_ip }} {{ vrf.routers.trans_2.mask }}
 {% else -%}
 ip address {{ vrf.routers.trans_2.r2_ip }} {{ vrf.routers.trans_2.mask }}
 {% endif -%}
 no ip redirects
 ip pim sparse-mode
 ip ospf {{ vrf.routers.lag.vlan }} area {{ vrf.routers.trans_2.ospf_area }}
 no shutdown
!
interface Vlan{{ vrf.routers.lag.vlan }}
 description {{ vrf.name }} {{ vrf.routers.lag.description }}
 vrf forwarding {{ vrf.name }}
 {% if inventory_hostname[-1] == "1" -%}
 ip address {{ vrf.routers.lag.r1_ip }} {{ vrf.routers.lag.mask }}
 {% else -%}
 ip address {{ vrf.routers.lag.r2_ip }} {{ vrf.routers.lag.mask }}
 {% endif -%}
 {%- for ip in vrf.routers.lag.helpers -%}
 ip helper-address {{ ip }}
 {% endfor -%}
 {% if vrf.routers.lag.fhrp_type.upper() == "HSRP" -%}
 standby version 2
 standby {{ vrf.routers.lag.hsrp.group }} ip {{ vrf.routers.lag.hsrp.gw_ip }}
 standby {{ vrf.routers.lag.hsrp.group }} timers 1 3
 {% endif -%}
 {% if inventory_hostname[-1] == "1" -%}
 standby {{ vrf.routers.lag.hsrp.group }} priority 110
 standby {{ vrf.routers.lag.hsrp.group }} preempt
 {% endif -%}
 no ip redirects
 ip pim sparse-mode
 ip ospf {{ vrf.routers.lag.vlan }} area {{ vrf.routers.lag.ospf_area }}
 no shutdown
!
!
router ospf {{ vrf.routers.lag.vlan }} vrf {{ vrf.name }}
 {% if inventory_hostname[-1] == "1" -%}
 router-id {{ vrf.routers.lag.r1_ip }}
 {% else -%}
 router-id {{ vrf.routers.lag.r2_ip }}
 {% endif -%}
 auto-cost reference-bandwidth 100000
 capability vrf-lite
 area {{ vrf.routers.lag.ospf_area }} range {{ vrf.routers.routing.ospf.network }} {{ vrf.routers.lag.mask }}
!
!
!
!
#}
end
